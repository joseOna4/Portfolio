<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <link rel="stylesheet" href="proyectos.css">
    <!-- Añadimos GSAP para las animaciones -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="transition.js"></script>
    <!-- Añadimos Font Awesome para el icono del menú hamburguesa -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Overlay para la animación de expansión -->
    <div class="overlay"></div>

    <!-- Contenedor para el proyecto expandido -->
    <div class="proyecto-expandido">
        <div class="proyecto-expandido-contenido">
            <img src="" alt="" class="proyecto-expandido-imagen">
        </div>
    </div>

    <!-- CURSOR -->
    <div class="cursor"></div>

    <header>
        <div class="cabecera-container">
            <div class="cabecera">
                <a href="index.html">José<span class="linea"></span>Cervera.</a>
            </div>
            <!-- Botón de menú hamburguesa para móviles -->
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="navbar">
                <!-- Añadir un botón de cierre explícito dentro del menú desplegable -->
                <div class="close-menu">
                    <i class="fas fa-times"></i>
                </div>
                <nav>
                    <ul>
                        <li><a href="proyectos.html">Proyectos</a></li>
                        <li><a href="sobremi.html">Sobre mí</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    
    <main>
        <div class="titulo-seccion">
            <h1>Mis /<span class="forms">proyectos</span></h1>
        </div>

        <!-- Galería de proyectos -->
        <div class="galeria-container">
            <div class="galeria">
                <div class="proyecto">
                    <a href="P1/p1.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/06.jpg" alt="Descripción de la imagen 1">
                        </div>
                    </a>
                </div>
                <div class="proyecto">
                    <a href="P2/p2.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/2.jpg" alt="Descripción de la imagen 2">
                        </div>
                    </a>
                </div>
                <div class="proyecto">
                    <a href="P3/p3.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/3.jpg" alt="Descripción de la imagen 3">
                        </div>
                    </a>
                </div>
                <div class="proyecto">
                    <a href="P4/p4.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/Free_Vinyl_Mockup_1.png" alt="Descripción de la imagen 4">
                        </div>
                    </a>
                </div>
                <div class="proyecto">
                    <a href="P5/p5.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/Free_Wine_Bottle_Mockup_2.png" alt="Descripción de la imagen 5">
                        </div>
                    </a>
                </div>
                <div class="proyecto">
                    <a href="P6/p6.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/phone.jpg" alt="Descripción de la imagen 6">
                        </div>
                    </a>
                </div>
                <div class="proyecto">
                    <a href="P7/p7.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/331.jpg" alt="Descripción de la imagen 7">
                        </div>
                    </a>
                </div>
           <!--
            <div class="proyecto">
                    <a href="P8/p8.html" class="proyecto-link">
                        <div class="proyecto-imagen">
                            <img src="ImgHome/sffffff3.jpg" alt="Descripción de la imagen 8">
                        </div>
                    </a>
                </div>
                -->
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <span>&copy;2025, Alicante</span>
            <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">Volver Arriba</a>
            <a href="https://www.instagram.com/on_cervera/" target="_blank">Instagram</a>
        </div>
    </footer>

    <script>
        // Detectar si es un dispositivo móvil o tablet
        const isMobileOrTablet = () => {
            return window.innerWidth <= 1024;
        };

        // Cursor personalizado
        const cursor = document.querySelector('.cursor');
        
        // Solo activar el cursor personalizado en desktop
        if (!isMobileOrTablet()) {
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            });
        } else {
            cursor.style.display = 'none';
            document.body.classList.add('mobile');
        }
    
        // Registrar el plugin ScrollTrigger
        gsap.registerPlugin(ScrollTrigger);
    
        // Animación para el título
        gsap.from(".titulo-seccion h1", {
            duration: 1.2,
            y: 50,
            opacity: 0,
            ease: "power3.out"
        });
    
        // Animación para cada proyecto
        gsap.utils.toArray(".proyecto").forEach((proyecto, i) => {
            gsap.set(proyecto, {
                opacity: 0,
                y: 50
            });
    
            gsap.to(proyecto, {
                scrollTrigger: {
                    trigger: proyecto,
                    start: "top bottom-=100",
                    toggleActions: "play none none none"
                },
                duration: 0.8,
                opacity: 1,
                y: 0,
                ease: "power3.out",
                delay: 0.15 * i
            });
        });
    
        // Efecto hover y clic para los proyectos
        const proyectos = document.querySelectorAll('.proyecto');
        const overlay = document.querySelector('.overlay');
        const proyectoExpandido = document.querySelector('.proyecto-expandido');
        const proyectoExpandidoImagen = document.querySelector('.proyecto-expandido-imagen');
    
        // Verificar si estamos llegando desde una transición
        window.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('regresando') === 'true') {
                // Limpiar la bandera
                sessionStorage.removeItem('regresando');
                
                // Ocultar el overlay inmediatamente
                gsap.set(overlay, { autoAlpha: 0 });
                gsap.set(proyectoExpandido, { autoAlpha: 0 });
            }
        });
    
        proyectos.forEach(proyecto => {
            const imagen = proyecto.querySelector('.proyecto-imagen');
            const img = proyecto.querySelector('.proyecto-imagen img');
            const enlace = proyecto.querySelector('a').getAttribute('href');
    
            // Efecto hover (solo en desktop)
            if (!isMobileOrTablet()) {
                proyecto.addEventListener('mouseenter', () => {
                    gsap.to(imagen, {
                        scale: 0.9075,
                        borderRadius: '1.5rem',
                        duration: 0.5,
                        ease: "power2.out"
                    });
        
                    gsap.to(img, {
                        scale: 1.2,
                        duration: 0.5,
                        ease: "power2.out"
                    });
                });
        
                proyecto.addEventListener('mouseleave', () => {
                    gsap.to(imagen, {
                        scale: 1,
                        borderRadius: '1rem',
                        duration: 0.5,
                        ease: "power2.out"
                    });
        
                    gsap.to(img, {
                        scale: 1,
                        duration: 0.5,
                        ease: "power2.out"
                    });
                });
            }
    
            // Efecto de clic para expandir
            proyecto.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Obtener la posición y dimensiones del proyecto
                const rect = proyecto.getBoundingClientRect();
                const imgSrc = img.src;
                
                // Guardar información para la transición
                sessionStorage.setItem('transicionActiva', 'true');
                sessionStorage.setItem('imagenProyecto', imgSrc);
                sessionStorage.setItem('destinoURL', enlace);
                
                // Establecer la imagen en el contenedor expandido
                proyectoExpandidoImagen.src = imgSrc;
                
                // Configurar el estado inicial del contenedor expandido
                gsap.set(proyectoExpandido, {
                    x: rect.left,
                    y: rect.top,
                    width: rect.width,
                    height: rect.height,
                    autoAlpha: 1,
                    visibility: 'visible'
                });
                
                // Animar la expansión
                const tl = gsap.timeline();
                
                tl.to(overlay, {
                    autoAlpha: 0.8,
                    duration: 0.3
                })
                .to(proyectoExpandido, {
                    x: 0,
                    y: 0,
                    width: '100%',
                    height: '100%',
                    duration: 0.6,
                    ease: "power2.inOut"
                }, "-=0.1")
                .to(proyectoExpandidoImagen, {
                    scale: 1.1,
                    duration: 0.6,
                    ease: "power2.inOut",
                    onComplete: function() {
                        // Navegar a la página del proyecto
                        window.location.href = enlace;
                    }
                }, "-=0.6");
                
                // Ocultar el scroll durante la animación
                document.body.style.overflow = 'hidden';
            });
        });

        // Menú hamburguesa para móviles
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.navbar').classList.toggle('active');
            this.classList.toggle('active');
            document.body.classList.toggle('menu-open');
        });

        // Manejar el botón de cierre del menú
        document.querySelector('.close-menu').addEventListener('click', function () {
            document.querySelector('.navbar').classList.remove('active');
            document.querySelector('.menu-toggle').classList.remove('active');
            document.body.classList.remove('menu-open');
        });

        // Cerrar el menú al hacer clic en los enlaces de navegación
        document.querySelectorAll('.navbar a').forEach(link => {
            link.addEventListener('click', function () {
                document.querySelector('.navbar').classList.remove('active');
                document.querySelector('.menu-toggle').classList.remove('active');
                document.body.classList.remove('menu-open');
            });
        });

        // Manejar cambios de tamaño de ventana
        window.addEventListener('resize', function () {
            if (isMobileOrTablet()) {
                document.body.classList.add('mobile');
                cursor.style.display = 'none';
            } else {
                document.body.classList.remove('mobile');
                cursor.style.display = 'block';
            }
        });
    </script>
    
    <script>
        // Script específico para manejar la navegación hacia atrás en proyectos.html
        document.addEventListener('DOMContentLoaded', function() {
          // Ocultar elementos de proyecto expandido al cargar la página
          const overlay = document.querySelector('.overlay');
          const proyectoExpandido = document.querySelector('.proyecto-expandido');
          
          if (overlay) gsap.set(overlay, { autoAlpha: 0 });
          if (proyectoExpandido) gsap.set(proyectoExpandido, { autoAlpha: 0, visibility: 'hidden' });
        });
        
        // Manejar evento de navegación hacia atrás
        window.addEventListener('pageshow', function(event) {
          if (event.persisted) {
            // Ocultar inmediatamente los elementos que causan el parpadeo
            const overlay = document.querySelector('.overlay');
            const proyectoExpandido = document.querySelector('.proyecto-expandido');
            
            if (overlay) gsap.set(overlay, { autoAlpha: 0 });
            if (proyectoExpandido) gsap.set(proyectoExpandido, { autoAlpha: 0, visibility: 'hidden' });
            
            // Asegurar que la galería sea visible
            gsap.set('main', { autoAlpha: 1 });
            
            // IMPORTANTE: Restaurar el scroll
            document.body.style.overflow = '';
            
            // Forzar reflow para Chrome
            setTimeout(function() {
              window.scrollTo(0, 0);
              document.body.style.display = 'none';
              document.body.offsetHeight; // Forzar reflow
              document.body.style.display = '';
            }, 10);
          }
        });
      </script>

      <script src="linkRewriter.js"></script>
</body>

</html>
